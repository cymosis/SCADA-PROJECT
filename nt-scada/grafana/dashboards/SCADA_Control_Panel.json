{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": 6,
  "links": [],
  "liveNow": false,
  "panels": [
    {
      "datasource": {
        "type": "influxdb",
        "uid": "P951FEA4DE68E13C5"
      },
      "gridPos": {
        "h": 15,
        "w": 16,
        "x": 0,
        "y": 0
      },
      "id": 1,
      "options": {
        "code": {
          "language": "plaintext",
          "showLineNumbers": false,
          "showMiniMap": false
        },
        "content": "<div style=\"padding: 20px; font-family: Arial, sans-serif; background: linear-gradient(135deg, #1e3a5f 0%, #2d5a8a 100%); border-radius: 10px;\">\n  <h2 style=\"color: #fff; margin-bottom: 20px; text-align: center; font-size: 28px;\">\n    ğŸ›ï¸ SCADA Control Panel\n  </h2>\n  \n  <div style=\"background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #ffc107;\">\n    <h3 style=\"color: #ffc107; margin: 0 0 10px 0;\">âš ï¸ Safety Notice</h3>\n    <p style=\"color: #fff; margin: 0; font-size: 14px;\">\n      All control actions are logged with operator name and reason. Unauthorized access is prohibited.\n    </p>\n  </div>\n  \n  <!-- Valve Controls -->\n  <h3 style=\"color: #fff; margin: 20px 0 15px 0; border-bottom: 2px solid rgba(255,255,255,0.2); padding-bottom: 10px;\">\n    ğŸš° Valve Controls\n  </h3>\n  <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin-bottom: 30px;\">\n    \n    <!-- Valve MV101 -->\n    <div style=\"background: rgba(255,255,255,0.08); padding: 20px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1);\">\n      <h4 style=\"color: #fff; margin: 0 0 15px 0; font-size: 18px;\">ğŸ”§ Valve MV101</h4>\n      <div style=\"display: flex; gap: 10px;\">\n        <button onclick=\"controlActuator('MV101', 'OPEN', 'valve')\" \n                style=\"flex: 1; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; border: none; padding: 12px; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 14px; transition: transform 0.2s;\"\n                onmouseover=\"this.style.transform='scale(1.05)'\" onmouseout=\"this.style.transform='scale(1)'\">\n          ğŸ”“ OPEN\n        </button>\n        <button onclick=\"controlActuator('MV101', 'CLOSE', 'valve')\" \n                style=\"flex: 1; background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white; border: none; padding: 12px; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 14px; transition: transform 0.2s;\"\n                onmouseover=\"this.style.transform='scale(1.05)'\" onmouseout=\"this.style.transform='scale(1)'\">\n          ğŸ”’ CLOSE\n        </button>\n      </div>\n    </div>\n    \n    <!-- Valve MV201 -->\n    <div style=\"background: rgba(255,255,255,0.08); padding: 20px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1);\">\n      <h4 style=\"color: #fff; margin: 0 0 15px 0; font-size: 18px;\">ğŸ”§ Valve MV201</h4>\n      <div style=\"display: flex; gap: 10px;\">\n        <button onclick=\"controlActuator('MV201', 'OPEN', 'valve')\" \n                style=\"flex: 1; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; border: none; padding: 12px; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 14px; transition: transform 0.2s;\"\n                onmouseover=\"this.style.transform='scale(1.05)'\" onmouseout=\"this.style.transform='scale(1)'\">\n          ğŸ”“ OPEN\n        </button>\n        <button onclick=\"controlActuator('MV201', 'CLOSE', 'valve')\" \n                style=\"flex: 1; background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white; border: none; padding: 12px; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 14px; transition: transform 0.2s;\"\n                onmouseover=\"this.style.transform='scale(1.05)'\" onmouseout=\"this.style.transform='scale(1)'\">\n          ğŸ”’ CLOSE\n        </button>\n      </div>\n    </div>\n    \n    <!-- Valve MV301 -->\n    <div style=\"background: rgba(255,255,255,0.08); padding: 20px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1);\">\n      <h4 style=\"color: #fff; margin: 0 0 15px 0; font-size: 18px;\">ğŸ”§ Valve MV301</h4>\n      <div style=\"display: flex; gap: 10px;\">\n        <button onclick=\"controlActuator('MV301', 'OPEN', 'valve')\" \n                style=\"flex: 1; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; border: none; padding: 12px; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 14px; transition: transform 0.2s;\"\n                onmouseover=\"this.style.transform='scale(1.05)'\" onmouseout=\"this.style.transform='scale(1)'\">\n          ğŸ”“ OPEN\n        </button>\n        <button onclick=\"controlActuator('MV301', 'CLOSE', 'valve')\" \n                style=\"flex: 1; background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white; border: none; padding: 12px; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 14px; transition: transform 0.2s;\"\n                onmouseover=\"this.style.transform='scale(1.05)'\" onmouseout=\"this.style.transform='scale(1)'\">\n          ğŸ”’ CLOSE\n        </button>\n      </div>\n    </div>\n  </div>\n  \n  <!-- Pump Controls -->\n  <h3 style=\"color: #fff; margin: 20px 0 15px 0; border-bottom: 2px solid rgba(255,255,255,0.2); padding-bottom: 10px;\">\n    âš™ï¸ Pump Controls\n  </h3>\n  <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin-bottom: 30px;\">\n    \n    <!-- Pump P101 -->\n    <div style=\"background: rgba(255,255,255,0.08); padding: 20px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1);\">\n      <h4 style=\"color: #fff; margin: 0 0 15px 0; font-size: 18px;\">ğŸ’§ Pump P101</h4>\n      <div style=\"display: flex; gap: 10px;\">\n        <button onclick=\"controlActuator('P101', 'ON', 'pump')\" \n                style=\"flex: 1; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; border: none; padding: 12px; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 14px; transition: transform 0.2s;\"\n                onmouseover=\"this.style.transform='scale(1.05)'\" onmouseout=\"this.style.transform='scale(1)'\">\n          â–¶ï¸ START\n        </button>\n        <button onclick=\"controlActuator('P101', 'OFF', 'pump')\" \n                style=\"flex: 1; background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white; border: none; padding: 12px; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 14px; transition: transform 0.2s;\"\n                onmouseover=\"this.style.transform='scale(1.05)'\" onmouseout=\"this.style.transform='scale(1)'\">\n          â¹ï¸ STOP\n        </button>\n      </div>\n    </div>\n    \n    <!-- Pump P201 -->\n    <div style=\"background: rgba(255,255,255,0.08); padding: 20px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1);\">\n      <h4 style=\"color: #fff; margin: 0 0 15px 0; font-size: 18px;\">ğŸ’§ Pump P201</h4>\n      <div style=\"display: flex; gap: 10px;\">\n        <button onclick=\"controlActuator('P201', 'ON', 'pump')\" \n                style=\"flex: 1; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; border: none; padding: 12px; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 14px; transition: transform 0.2s;\"\n                onmouseover=\"this.style.transform='scale(1.05)'\" onmouseout=\"this.style.transform='scale(1)'\">\n          â–¶ï¸ START\n        </button>\n        <button onclick=\"controlActuator('P201', 'OFF', 'pump')\" \n                style=\"flex: 1; background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white; border: none; padding: 12px; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 14px; transition: transform 0.2s;\"\n                onmouseover=\"this.style.transform='scale(1.05)'\" onmouseout=\"this.style.transform='scale(1)'\">\n          â¹ï¸ STOP\n        </button>\n      </div>\n    </div>\n    \n    <!-- Pump P301 -->\n    <div style=\"background: rgba(255,255,255,0.08); padding: 20px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1);\">\n      <h4 style=\"color: #fff; margin: 0 0 15px 0; font-size: 18px;\">ğŸ’§ Pump P301</h4>\n      <div style=\"display: flex; gap: 10px;\">\n        <button onclick=\"controlActuator('P301', 'ON', 'pump')\" \n                style=\"flex: 1; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; border: none; padding: 12px; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 14px; transition: transform 0.2s;\"\n                onmouseover=\"this.style.transform='scale(1.05)'\" onmouseout=\"this.style.transform='scale(1)'\">\n          â–¶ï¸ START\n        </button>\n        <button onclick=\"controlActuator('P301', 'OFF', 'pump')\" \n                style=\"flex: 1; background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white; border: none; padding: 12px; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 14px; transition: transform 0.2s;\"\n                onmouseover=\"this.style.transform='scale(1.05)'\" onmouseout=\"this.style.transform='scale(1)'\">\n          â¹ï¸ STOP\n        </button>\n      </div>\n    </div>\n  </div>\n  \n  <!-- Emergency Shutdown -->\n  <div style=\"margin-top: 30px; padding: 25px; background: linear-gradient(135deg, rgba(220,53,69,0.3) 0%, rgba(200,35,51,0.3) 100%); border: 3px solid #dc3545; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.3);\">\n    <h3 style=\"color: #fff; margin: 0 0 15px 0; text-align: center;\">ğŸš¨ EMERGENCY CONTROLS</h3>\n    <button onclick=\"emergencyShutdown()\" \n            style=\"background: linear-gradient(135deg, #dc3545 0%, #bd2130 100%); color: white; border: none; padding: 18px 30px; border-radius: 5px; cursor: pointer; font-size: 18px; font-weight: bold; width: 100%; transition: transform 0.2s; box-shadow: 0 4px 6px rgba(0,0,0,0.3);\"\n            onmouseover=\"this.style.transform='scale(1.02)'\" onmouseout=\"this.style.transform='scale(1)'\">\n      ğŸš¨ EMERGENCY SHUTDOWN - STOP ALL SYSTEMS\n    </button>\n  </div>\n  \n  <!-- Status Display -->\n  <div id=\"statusDisplay\" style=\"margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 8px; display: none;\">\n    <h4 style=\"color: #fff; margin: 0 0 10px 0;\">Last Action:</h4>\n    <p id=\"statusText\" style=\"color: #fff; margin: 0; font-family: monospace;\"></p>\n  </div>\n</div>\n\n<script>\n// IMPORTANT: Using port 5001 instead of 5000 because MLflow is using 5000\n// Change this to your server's IP if accessing from another computer\nconst API_URL = 'http://localhost:5001';\n\nfunction showStatus(message, isError = false) {\n  const statusDisplay = document.getElementById('statusDisplay');\n  const statusText = document.getElementById('statusText');\n  \n  statusDisplay.style.display = 'block';\n  statusDisplay.style.borderLeft = isError ? '4px solid #dc3545' : '4px solid #28a745';\n  statusText.textContent = message;\n  statusText.style.color = isError ? '#ff6b6b' : '#51cf66';\n  \n  // Auto-hide after 5 seconds\n  setTimeout(() => {\n    statusDisplay.style.display = 'none';\n  }, 5000);\n}\n\nfunction controlActuator(actuatorId, action, type) {\n  // Confirmation prompt\n  const confirmMessage = `Are you sure you want to ${action} ${actuatorId}?`;\n  if (!confirm(confirmMessage)) return;\n  \n  // Get operator name\n  const operator = prompt(`Confirm ${action} for ${actuatorId}. Enter your name:`);\n  if (!operator || operator.trim() === '') {\n    alert('âš ï¸ Operator name is required. Action cancelled.');\n    return;\n  }\n  \n  // Get reason\n  const reason = prompt(`Reason for ${action}ing ${actuatorId}:`);\n  if (!reason || reason.trim() === '') {\n    alert('âš ï¸ Reason is required. Action cancelled.');\n    return;\n  }\n  \n  // Determine endpoint and payload\n  const endpoint = type === 'valve' ? '/control/valve' : '/control/pump';\n  const payload = type === 'valve' \n    ? { valve_id: actuatorId, action: action, operator: operator.trim(), reason: reason.trim() }\n    : { pump_id: actuatorId, action: action, operator: operator.trim(), reason: reason.trim() };\n  \n  // Show loading\n  showStatus(`Sending ${action} command to ${actuatorId}...`, false);\n  \n  // Send request\n  fetch(`${API_URL}${endpoint}`, {\n    method: 'POST',\n    headers: { \n      'Content-Type': 'application/json',\n      'Accept': 'application/json'\n    },\n    body: JSON.stringify(payload)\n  })\n  .then(response => {\n    if (!response.ok) {\n      return response.json().then(err => { throw err; });\n    }\n    return response.json();\n  })\n  .then(data => {\n    const message = `âœ… SUCCESS: ${data.message} | Operator: ${operator} | Time: ${new Date().toLocaleTimeString()}`;\n    showStatus(message, false);\n    alert(`âœ… ${data.message}`);\n  })\n  .catch(error => {\n    const errorMessage = `âŒ ERROR: ${error.error || error.message || 'Unknown error occurred'}`;\n    showStatus(errorMessage, true);\n    alert(`âŒ Error: ${error.error || error.message || 'Failed to control actuator'}`);\n    console.error('Control error:', error);\n  });\n}\n\nfunction emergencyShutdown() {\n  // First confirmation\n  const confirmed1 = confirm('âš ï¸ WARNING: This will shut down ALL pumps and close ALL valves. Are you absolutely sure?');\n  if (!confirmed1) return;\n  \n  // Second confirmation\n  const confirmed2 = confirm('âš ï¸âš ï¸âš ï¸ FINAL WARNING: This action cannot be undone. Continue with EMERGENCY SHUTDOWN?');\n  if (!confirmed2) return;\n  \n  // Get operator name\n  const operator = prompt('Enter your name to authorize EMERGENCY SHUTDOWN:');\n  if (!operator || operator.trim() === '') {\n    alert('âš ï¸ Operator name is required. Emergency shutdown cancelled.');\n    return;\n  }\n  \n  // Get reason\n  const reason = prompt('Reason for EMERGENCY SHUTDOWN:');\n  if (!reason || reason.trim() === '') {\n    alert('âš ï¸ Reason is required. Emergency shutdown cancelled.');\n    return;\n  }\n  \n  // Show loading\n  showStatus('ğŸš¨ Executing EMERGENCY SHUTDOWN...', false);\n  \n  // Send request\n  fetch(`${API_URL}/control/emergency_shutdown`, {\n    method: 'POST',\n    headers: { \n      'Content-Type': 'application/json',\n      'Accept': 'application/json'\n    },\n    body: JSON.stringify({ operator: operator.trim(), reason: reason.trim() })\n  })\n  .then(response => {\n    if (!response.ok) {\n      return response.json().then(err => { throw err; });\n    }\n    return response.json();\n  })\n  .then(data => {\n    const message = `ğŸš¨ EMERGENCY SHUTDOWN EXECUTED: ${data.actuators_affected} actuators stopped | Operator: ${operator} | Time: ${new Date().toLocaleTimeString()}`;\n    showStatus(message, false);\n    alert(`ğŸš¨ ${data.message}\\n\\nActuators affected: ${data.actuators_affected}\\nOperator: ${operator}`);\n  })\n  .catch(error => {\n    const errorMessage = `âŒ EMERGENCY SHUTDOWN FAILED: ${error.error || error.message || 'Unknown error'}`;\n    showStatus(errorMessage, true);\n    alert(`âŒ Emergency shutdown failed: ${error.error || error.message || 'Unknown error occurred'}`);\n    console.error('Emergency shutdown error:', error);\n  });\n}\n\n// Test API connection on page load\nwindow.addEventListener('load', function() {\n  fetch(`${API_URL}/health`)\n    .then(response => response.json())\n    .then(data => {\n      console.log('âœ… Control API connected:', data);\n    })\n    .catch(error => {\n      console.error('âŒ Control API not available:', error);\n      alert('âš ï¸ Warning: Control API is not responding on port 5001. Please check if the service is running.');\n    });\n});\n</script>\n",
        "mode": "html"
      },
      "pluginVersion": "10.2.0",
      "targets": [
        {
          "datasource": {
            "type": "influxdb",
            "uid": "P951FEA4DE68E13C5"
          },
          "refId": "A"
        }
      ],
      "title": "Panel Title",
      "type": "text"
    }
  ],
  "refresh": "",
  "schemaVersion": 38,
  "tags": [],
  "templating": {
    "list": []
  },
  "time": {
    "from": "now-6h",
    "to": "now"
  },
  "timepicker": {},
  "timezone": "",
  "title": "SCADA Control Panel",
  "uid": "ef2a9bcf-c468-4c0d-899b-d003d354c4df",
  "version": 2,
  "weekStart": ""
}